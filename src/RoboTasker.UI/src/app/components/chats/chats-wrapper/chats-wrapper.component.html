<div class="chats-wrapper grid flex-grow-1">
  <div class="chats-list-wrapper col-12 lg:col-4">
    <p-card styleClass="chat-list-card">
      <div class="chats-list">
        <div class="topbar" *rbHasPermission="PermissionsNames.ChatCreate">
          <p-button (onClick)="createChat()" label="Create" icon="pi pi-plus" outlined class="w-full" styleClass="w-full"/>
          <p-divider/>
        </div>
        <div class="topbar-superadmin" *rbIsSuperAdmin>
          <p-button (onClick)="createChat()" label="Create" icon="pi pi-plus" outlined class="w-full" styleClass="w-full"/>
          <p-divider/>
        </div>

        <div class="list">
          @for (chat of chats(); track chat.id) {
            <p-context-menu #cm (onHide)="onCmHide()" [model]="contextMenuItems"/>
            <div #chatEl (click)="goToChat(chat)"
                 (contextmenu)="onContextMenu(chat, $event)"
                 class="mt-3 chat-link flex flex-row flex-wrap gap-2 align-items-center border-1 border-round p-2 py-3
                hover:bg-black-alpha-30 cursor-pointer border-100 justify-content-between">
              <div class="avatar">
                <p-avatar icon="pi pi-user" [textContent]="chat.name.slice(0,2)"/>
              </div>
              <div class="main-info flex-grow-1 flex flex-column gap-1">
                <span class="font-semibold">{{ chat.name }}</span>
                @if (chat.lastMessage) {
                  <span class="text-gray-500 max-w-13rem lg:max-w-8rem text-overflow-ellipsis white-space-nowrap overflow-hidden">
                    {{ chat.lastMessage }}
                  </span>
                }
              </div>
              <div class="time text-sm text-gray-500">
                @let lastMessageText = calculateLastMessageOnChat(chat);
                {{ lastMessageText }}
              </div>
            </div>
          } @empty {
            No chats right now :(
          }
        </div>
      </div>
    </p-card>
  </div>
  <div class="chat-wrapper col-12 lg:col-8">
    <div class="chat h-full">
      @if (currentChatId()) {
        <router-outlet/>
      }
    </div>
  </div>
</div>
